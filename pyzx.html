<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>PyZX Demo</title>
    <link rel="stylesheet" type="text/css" href="/css/normalize.css">
    <link rel="stylesheet" type="text/css" href="/css/intro.css">
    <style>
        #console {
            background-color: #121;
            color: #EEE;
            font-size: 12px;
            font-weight: 700;
        }

        .menu {
            cursor: pointer;
            border-bottom: 1px dashed;
        }

        #editor {
            min-width: 500px;
            min-height: 400px;
            float: left;
            font-size: 16px;
            z-index: 0;
        }

        .square {
            align-self: center;
            justify-self: center;
        }

        #run-button {
            font-size: xx-large;
        }

        #run-button-holder {
            text-align: center;
            padding-top: 1em;
        }

        #display-content {
            min-height: 350px;
            width: 90%;
            margin: auto;
            overflow: auto;
        }

        div.example {
            display: none;
        }

        #obscure {
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            bottom: 0;
            z-index: 2;
            background-color: rgba(255, 255, 255, 0.8);
            text-align: center;
            padding: 5em;
        }
    </style>
</head>

<body onload="brython({debug: 0, indexedDB: true})">
<nav>
    <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/intro.html">Tutorial</a></li>
        <li><a href="/publications.html">Publications</a></li>
        <li><a href="/accessibility.html">Accessibility</a></li>
        <li><a href="/map.html">Map</a></li>
        <li><a href="/pyzx.html">PyZX Demo</a></li>
    </ul>
</nav>
<main>
    <div id="obscure">
        <h1>
            Loading...
        </h1>
    </div>
    <div style="display: grid; 
grid-template-columns: 3fr 6fr 4fr;">
        <div class="row cell title shaded">
            <h1>PyZX Demo</h1>
            <p>
                An in-browser implementation of the protocol that was published <a
                    href="https://arxiv.org/abs/1903.10477">here</a>,
                based on <a href="https://arxiv.org/abs/1904.04735#">PyZX</a>.
            </p>
        </div>

        <div class="row cell">
            <h3>
                How to use this tool
            </h3>
            <p id="explanation">
                <a href="https://github.com/Quantomatic/pyzx">PyZX</a> is a tool for analysing ZX diagrams (and
                therefore also quantum circuit diagrams,)
                written in Python by a team at Radboud.
                This webpage implements the same code, allowing you to use the tool inside your browser.
                Below this description are three panels,
                the first gives a list of example python scripts you can try out
                (click on them to load the code,)
                the second shows the python script to be run,
                and the third panel shows the console output of that code.
                To run the python script press the "Run Code" button,
                and any diagrams generated by the script will be shown at the bottom of the page.
            </p>
        </div>
        <div class="square">
            <h3>Example scripts</h3>
        </div>
        <div class="square">
            <h3>Script to run</h3>
        </div>
        <div class="square">
            <h3>Console output</h3>
        </div>
        <div class="square console">
            <ul id="menu">
            </ul>
            <div class="example" id="ex3">
                <button>T-count optimisation</button>
                <script type="text/template">
                    # We list here the 'fast' circuits from https://github.com/Quantomatic/pyzx
                    # Note that this is a demonstration running inside your browser
                    # And so will be slower than running PyZX directly

                    # Here is a list of the circuits included with this demonstration:
                    circuits = ['mod5_4',
                        'barenco_tof_3', 'barenco_tof_4', 'barenco_tof_5',
                        'csla_mux_3_original', 'csum_mux_9_corrected',
                        'gf2^4_mult', 'mod_mult_55', 'mod_red_21',
                        'qcla_adder_10', 'qcla_com_7', 'qcla_mod_7',
                        'QFT8', 'QFTAdd8', 'rc_adder_6',
                        'tof_3', 'tof_4', 'tof_5',
                        'vbe_adder_3']

                    class NameSpace:
                        pass
                    ns = NameSpace()
                    ns.circ_name = 'mod5_4'
                    ns.circ = zx.Circuit.from_quipper_file("./circuits/"+ns.circ_name+"_before")
                    ns.circ = ns.circ.to_basic_gates()

                    def change(event):
                        l = event.target
                        ns.circ_name = l.options[l.selectedIndex].value
                        print(ns.circ_name)
                        ns.circ = zx.Circuit.from_quipper_file("./circuits/"+ns.circ_name+"_before")
                        ns.circ = ns.circ.to_basic_gates()
                        div_display.clear()
                        display([dropdown,show_button,simp_button,tele_button])
                        display(ns.circ.stats())

                    def original(event):
                        display("Original circuit:")
                        display(ns.circ)

                    def simplify(event):
                        display("Simplified diagram:")
                        g = ns.circ.to_graph()
                        zx.simplify.full_reduce(g)
                        display(zx.draw(g))

                    def tele(event):
                        display("Circuit after phase teleportation:")
                        g = zx.simplify.teleport_reduce(ns.circ.to_graph())
                        display(g)

                    dropdown = html.SELECT(html.OPTION(s) for s in circuits)
                    dropdown.bind("change", change)
                    show_button = html.BUTTON("Show original")
                    show_button.bind("click", original)
                    simp_button = html.BUTTON("Simplified")
                    simp_button.bind("click", simplify)
                    tele_button = html.BUTTON("Phase teleport")
                    tele_button.bind("click", tele)

                    display([dropdown,show_button,simp_button,tele_button])

                    display(ns.circ.stats())
                </script>
            </div>
            <div class="example" id="ex0">
                <button>Generating and simplifying a Circuit</button>
                <script type="text/template">
                        # Generate a random circuit on 3 qubits, depth 20
                        g = zx.generate.cliffordT(3,20)
                        # Draw the circuit
                        display(zx.draw(g))
                        # Now simplify it
                        zx.simplify.full_reduce(g)
                        g.normalise()
                        # And draw the simplified version
                        display(zx.draw(g))
                    </script>
            </div>
            <div class="example" id="ex1">
                <button>Manually constructing a ZX-diagram</button>
                <script type="text/template">
                        # Instantiate an empty graph
                        g = zx.Graph()
                        # Add vertices using the following command:
                        #   add_vertex(vertex_type, qubit_num, row_num, phase)
                        i = g.add_vertex(0, 0, 0)
                        v = g.add_vertex(1, 0, 1, Fraction(1,2))
                        w = g.add_vertex(2, 0, 2, Fraction(-1,2))
                        o = g.add_vertex(0, 0, 3)
                        g.add_edges([(i,v),(v,w),(w,o)])
                        # Then draw it
                        display(zx.draw(g))
                    </script>
            </div>


            <div class="example" id="ex2">
                <button>Converting ZX-diagram to tikz</button>
                <script type="text/template">
                        # Generate a circuit on 3 qubits, depth 10
                        g = zx.generate.cliffordT(3,10)
                        # Draw the graph
                        display(g)
                        # Output the tikz
                        display(zx.tikz.to_tikz(g))
                    </script>
            </div>

        </div>
        <div class="square">
            <div id="editor" class="console"></div>
        </div>
        <div class="square" style="width: 100%; height: 100%;">
            <textarea class="console" id="console"></textarea>
        </div>
    </div>
    <div class="row" id="run-button-holder">
        <button id="run-button">Loading PyZX, please wait</button>
    </div>
    <div class="row cell">
        <h3>
            The output of the code will be displayed here:
        </h3>
    </div>

    <div class="row" id="display-content">
        Loading PyZX. This can take a few seconds.
    </div>
</main>
<footer>
    <p class="subtle">
        Website by <a href="https://hjmb.co.uk">Hector Miller-Bakewell</a>
        and <a href="https://vdwetering.name">John van de Wetering</a>,
        with thanks to
        <a href="https://quantum.univ-grenoble-alpes.fr/fostering-the-ecosystem/our-chairs-of-excellence/quantum-computing/horsman-dominic-734445.htm">
            Dom Horsman
        </a>
        and Richard East
    </p>
</footer>

<script type="text/python">
    from browser import window
    editor = window.ace.edit("editor")
    editor.setTheme("ace/theme/monokai")
    session = editor.getSession()
    session.setMode("ace/mode/python")
</script>

<script type="text/python">
    from browser import document, html, window

    editor = window.ace.edit("editor")

    current = None

    def load_example(ev):
        global current
        if current is not None:
            document["a"+current].style.fontWeight = "normal"
        example_id = ev.target.num
        ev.target.style.fontWeight = "bold"

        example = document[example_id]
        src = example.get(selector="script")[0].text
        while src.startswith("\n"):
            src = src[1:]
        indent = 0
        while src[indent] == ' ':
            indent += 1
        src = "\n".join(line[indent:] for line in src.split("\n"))

        editor.setValue(src)

        current = example_id

    for example in document.get(selector=".example"):
        button = example.get(selector="button")[0]
        anchor = html.A(button.text, Class="menu", id="a"+example.id)
        anchor.num = example.id

        anchor.bind("click", load_example)
        document["menu"] <= html.LI(anchor)
</script>

<script type="text/python">
    import javascript
    from browser import document as doc, window, alert, html, timer

    import traceback
    import sys
    from fractions import Fraction

    editor = window.ace.edit("editor")

    #editor.setValue("""g = zx.generate.cliffordT(3,20)\ndisplay(zx.draw(g))\nzx.simplify.full_reduce(g)\ng.normalise()\ndisplay(zx.draw(g))""")
    editor.setValue("# Choose an example script from the panel to the left")
    import pyzx as zx

    div_display = doc["display-content"]
    div_display.html = ""
    button = doc["run-button"]
    console = doc["console"]

    class cOutput:
        encoding = 'utf-8'

        def __init__(self):
            self.cons = console
            self.buf = ''

        def write(self, data):
            self.buf += str(data)

        def flush(self):
            self.cons.value += self.buf
            self.buf = ''

        def reset(self):
            self.buf = ''
            self.cons.value = ''

        def __len__(self):
            return len(self.buf)

    cOut = cOutput()
    sys.stdout = cOut
    sys.stderr = cOut

    def display(item, raw=False):
        if isinstance(item, str):
            if raw:
                div_display.html += item
            else:
                div_display <= html.PRE(item)
            return
        elif hasattr(item, "to_tensor"): # It is a circuit or graph
            item = zx.draw(item)
        for e in item:
            div_display <= e
        div_display.scrollIntoView()

    def respond(ev=None):
        button.innerHTML = "Running..."
        cOut.reset()
        div_display.html = ""
        timer.set_timeout(run_code,0) # Give control back to browser
        #

    def run_code():
        content = editor.getValue()
        content += "\nNone" # Hack to make it be an expression, and not a statement
        try:
            eval(content)
        except Exception as exc:
            traceback.print_exc(file=sys.stderr)
        sys.stdout.flush()
        button.innerHTML = "Run Code"

    button.bind('click', respond)

    #timer.set_timeout(respond,0)
    button.innerHTML = "Run Code"
    doc["obscure"].hidden = True
</script>


<script src="js/require.js"></script>
<script src="js/main.js"></script>


<script src="js/ace/ace.js"></script>
<script src="js/ace/ext-language_tools.js"></script>
<script src="js/ace/mode-python.js"></script>
<script src="js/ace/snippets/python.js"></script>

<script src="js/brython.js"></script>
<script src="js/brython_modules.js"></script>

</body>

</html>